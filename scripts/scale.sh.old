#INPUT VARS
IN=$1							#input file
SIZE=$2							#size of job

#INITIALIZE ARRAY
#for ((i=4; i<10; i++)); do THR[$(($i-3))]=`echo "2^$i"|bc`; done	#increasing powers of 2
for ((i=4; i<=20; i++)); do THR[$(($i-3))]=`echo "$i^2"|bc`; done	#perfect squares

#MANUAL CHANGE VARS
Q=pmillett						#queue to submit jobs to
PPN=16							#processes per node
WT=10:00:00						#walltime

#CHECK INPUTS
if [ -e $1 ]; then					#check input file exists
 if [[ $2 =~ ^[0-9]+$ ]]; then				#check that job size is an integer
  
  for ((i=1; i<=${#THR[@]}; i++)); do
  N=`echo "$((${THR[$i]}+$(($PPN-1))))/$PPN" | bc`

  #CREATE PBS FILES
  echo "#PBS -q $Q
	#PBS -l nodes=$N:ppn=$PPN
	#PBS -l walltime=$WT
	#PBS -o 512scale$i.out

	cd /home/beberry/SCALE						
	module load gcc
	module load openmpi	
	
	mpirun -n ${THR[$i]} ./$IN $SIZE" | sed 's/\t//' | sed 's/REPLACE/$PBS_O_WORKDIR/' > 512scale$i.pbs
  done

 else echo "ERROR: Job size (2nd arg) not an integer"; fi   
else echo "ERROR: File (1st arg) does not exist"; fi


